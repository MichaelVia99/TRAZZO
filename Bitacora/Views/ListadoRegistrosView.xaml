<UserControl x:Class="Bitacora.Views.ListadoRegistrosView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:Bitacora.Models"
             Background="Transparent">
    <UserControl.Resources>
        <Style x:Key="HeaderActionButtonStyle" TargetType="Button">
            <Setter Property="Height" Value="30"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="4" Padding="0">
                            <Border.Effect>
                                <DropShadowEffect Color="Black" Direction="270" ShadowDepth="1" Opacity="0.1" BlurRadius="4"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="Black" Direction="270" ShadowDepth="0" Opacity="0" BlurRadius="0"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="border" Property="Margin" Value="0,2,0,0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Filtros -->
        <Grid Grid.Row="0" Margin="5,0,5,8">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <StackPanel.Resources>
                    <Style x:Key="FilterButtonBaseStyle" TargetType="Button">
                        <Setter Property="Margin" Value="0,0,3,0"/>
                        <Setter Property="Padding" Value="7,0"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Cursor" Value="Hand"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Opacity" Value="0.9"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </StackPanel.Resources>

                <Button  Background="{StaticResource StatusPlanificarBrush}" Foreground="White" Click="FilterPlanificar_Click" ToolTip="Por Planificar" Height="20">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource FilterButtonBaseStyle}">
                            <Setter Property="Opacity" Value="0.5"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding EstadoFiltroActual}" Value="{x:Static models:EstadoRegistro.Pendiente}">
                                    <Setter Property="Opacity" Value="1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <Viewbox Width="14" Height="14" Margin="0,0,5,0">
                            <Canvas Width="24" Height="24">
                                <!-- Calendario con signo de más para indicar planificación -->
                                <Path Data="M6 8 H18 V20 H6 Z"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeLineJoin="Round"
                                      Fill="Transparent"/>
                                <Path Data="M6 11 H18"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"/>
                                <Path Data="M9 4 V8"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"/>
                                <Path Data="M15 4 V8"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"/>
                                <Path Data="M12 13 V17"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"/>
                                <Path Data="M10 15 H14"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"/>
                            </Canvas>
                        </Viewbox>
                        <TextBlock Text="{Binding CountPlanificar}" Foreground="White" FontWeight="SemiBold" FontSize="10" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <Button Background="{StaticResource StatusEnEsperaBrush}" Foreground="White" Click="FilterEnEspera_Click" ToolTip="En Espera"  Height="20">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource FilterButtonBaseStyle}">
                            <Setter Property="Opacity" Value="0.5"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding EstadoFiltroActual}" Value="{x:Static models:EstadoRegistro.EnEspera}">
                                    <Setter Property="Opacity" Value="1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <Viewbox Width="13" Height="13" Margin="0,0,5,0">
                            <Grid Width="24" Height="24">
                                <Ellipse Width="20" Height="20"
                                         Stroke="White"
                                         StrokeThickness="2"
                                         HorizontalAlignment="Center"
                                         VerticalAlignment="Center"/>
                                <Canvas Width="24" Height="24">
                                    <Path Data="M12 6 L12 12"
                                          Stroke="White"
                                          StrokeThickness="2"
                                          StrokeStartLineCap="Round"
                                          StrokeEndLineCap="Round"/>
                                    <Path Data="M12 12 L16 14"
                                          Stroke="White"
                                          StrokeThickness="2"
                                          StrokeStartLineCap="Round"
                                          StrokeEndLineCap="Round"/>
                                </Canvas>
                            </Grid>
                        </Viewbox>
                        <TextBlock Text="{Binding CountEnEspera}"  Foreground="White" FontWeight="SemiBold" FontSize="10" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <Button Background="{StaticResource StatusEnCursoBrush}" Foreground="White" Click="FilterCurso_Click" ToolTip="En Curso"  Height="20">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource FilterButtonBaseStyle}">
                            <Setter Property="Opacity" Value="0.5"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding EstadoFiltroActual}" Value="{x:Static models:EstadoRegistro.EnProceso}">
                                    <Setter Property="Opacity" Value="1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <Viewbox Width="14" Height="14" Margin="0,0,5,0">
                            <Canvas Width="24" Height="24">
                                <Path Data="M8 5 L8 19 L19 12 Z"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeLineJoin="Round"
                                      Fill="White"/>
                            </Canvas>
                        </Viewbox>
                        <TextBlock Text="{Binding CountCurso}" Foreground="White" FontWeight="Bold" FontSize="10" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <Button Background="{StaticResource StatusPausadoBrush}"
                        Foreground="White"
                        Click="FilterPausado_Click"
                        ToolTip="En Pausa" Height="20">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource FilterButtonBaseStyle}">
                            <Setter Property="Opacity" Value="0.5"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding EstadoFiltroActual}" Value="{x:Static models:EstadoRegistro.Pausado}">
                                    <Setter Property="Opacity" Value="1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <Viewbox Width="14" Height="14" Margin="0,0,5,0">
                            <Canvas Width="24" Height="24">
                                <Path Data="M9 5 L9 19"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"/>
                                <Path Data="M15 5 L15 19"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"/>
                            </Canvas>
                        </Viewbox>
                        <TextBlock Text="{Binding CountPausado}"
                                   FontWeight="Bold"
                                   FontSize="10"
                                   HorizontalAlignment="Center"
                                   Foreground="White"/>
                    </StackPanel>
                </Button>

                <Button Background="{StaticResource StatusCompletadoBrush}" Foreground="White" Click="FilterCompletados_Click" ToolTip="Completados" Height="20">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource FilterButtonBaseStyle}">
                            <Setter Property="Opacity" Value="0.5"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding EstadoFiltroActual}" Value="{x:Static models:EstadoRegistro.Cerrado}">
                                    <Setter Property="Opacity" Value="1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <Viewbox Width="14" Height="14" Margin="0,0,5,0">
                            <Canvas Width="24" Height="24">
                                <Path Data="M5 12 L10 17 L19 7"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeLineJoin="Round"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"
                                      Fill="Transparent"/>
                            </Canvas>
                        </Viewbox>
                        <TextBlock Text="{Binding CountCompletados}" Foreground="White" FontWeight="Bold" FontSize="10" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <Button Background="{StaticResource StatusTodosBrush}" Foreground="White" Click="FilterTodos_Click" ToolTip="Todos" Height="20">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource FilterButtonBaseStyle}">
                            <Setter Property="Opacity" Value="0.5"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding EstadoFiltroActual}" Value="{x:Null}">
                                    <Setter Property="Opacity" Value="1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <Viewbox Width="14" Height="14" Margin="0,0,5,0">
                            <Canvas Width="24" Height="24">
                                <Path Data="M8 6 L20 6 M8 12 L20 12 M8 18 L20 18"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"/>
                            </Canvas>
                        </Viewbox>
                        <TextBlock Text="{Binding CountTodos}" Foreground="White" FontWeight="Bold" FontSize="10" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,5,0">
                <Button x:Name="NuevoRegistroButton" ToolTip="Agregar Registro"
                        Click="NuevoRegistroButton_Click"
                        Style="{StaticResource HeaderActionButtonStyle}"
                        Background="{StaticResource NewButtonRedBrush}" Height="20">
                    <Viewbox Width="14" Height="14">
                        <Canvas Width="24" Height="24">
                            <Path Data="M12 5 L12 19"
                                  Stroke="White"
                                  StrokeThickness="2"
                                  StrokeStartLineCap="Round"
                                  StrokeEndLineCap="Round"/>
                            <Path Data="M5 12 L19 12"
                                  Stroke="White"
                                  StrokeThickness="2"
                                  StrokeStartLineCap="Round"
                                  StrokeEndLineCap="Round"/>
                        </Canvas>
                    </Viewbox>
                </Button>
            </StackPanel>
        </Grid>

        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Margin="5,5"
                      Padding="0,0,0,0">
            <ItemsControl x:Name="RegistrosItemsControl" ItemsSource="{Binding Registros}" Background="Transparent" Grid.IsSharedSizeScope="True" Margin="0,0,5,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type models:Registro}">
                        <Border Background="{StaticResource CardBackground}"
                                BorderBrush="{StaticResource CardBorder}"
                                BorderThickness="0.5"
                                CornerRadius="4"
                                Margin="0,0,0,4"
                                Padding="0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="0"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Barra lateral de color -->
                                <Border Grid.Column="0" 
                                        Background="{Binding ColorEstado, Mode=OneWay}" 
                                        CornerRadius="4,0,0,4"/>

                                <Grid Grid.Column="1" Margin="6,4">
                                    <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="ColIcono"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="ColTiempo"/>
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="ColPrioridad"/>
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="ColEstado"/>
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="ColUsuario"/>
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="ColAcciones"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- 1. Icono y Código -->
                                <Border Grid.Column="0" 
                                        Width="30" Height="28" 
                                        CornerRadius="4" 
                                        Background="{Binding ColorTipoBrush}" 
                                        Margin="0,0,8,0"
                                        VerticalAlignment="Center">
                                    <StackPanel Orientation="Vertical" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding IconoTipo}" 
                                                   FontFamily="Segoe MDL2 Assets" 
                                                   FontSize="12" 
                                                   Foreground="White" 
                                                   HorizontalAlignment="Center"
                                                   Margin="0,0,0,0"/>
                                        <TextBlock Text="{Binding CodigoFull}" 
                                                   FontWeight="SemiBold" 
                                                   Foreground="White" 
                                                   FontSize="9" 
                                                   HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- 2. Proyecto + Empresa y Barra de Progreso -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,0,8,0">
                                    <Grid Margin="0,0,0,1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding Proyecto}" 
                                                   Foreground="{StaticResource TextSecondary}" 
                                                   FontSize="9" 
                                                   FontWeight="SemiBold"
                                                   TextTrimming="CharacterEllipsis"/>
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding Empresa}" 
                                                   Foreground="{StaticResource TextSecondary}" 
                                                   FontSize="9" 
                                                   FontWeight="SemiBold"
                                                   TextTrimming="CharacterEllipsis"
                                                   HorizontalAlignment="Right"/>
                                    </Grid>

                                    <TextBlock Margin="0,0,0,0" VerticalAlignment="Center" TextTrimming="CharacterEllipsis">
                                        <Run Text="{Binding Titulo}"  Foreground="{StaticResource TextPrimary}" FontSize="10"/>
                                    </TextBlock>
                                    
                                    <ProgressBar Height="3" 
                                                 Minimum="0" 
                                                 Maximum="{Binding TiempoEstimado}" 
                                                 Value="{Binding TiempoTranscurrido}" 
                                                 Background="{StaticResource NeutralBorderBrush}" 
                                                 Foreground="{Binding ColorEstadoBrush}" 
                                                 BorderThickness="0">
                                        <ProgressBar.Style>
                                            <Style TargetType="ProgressBar">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding TiempoEstimado}" Value="0">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ProgressBar.Style>
                                    </ProgressBar>

                                    <!-- Barra de Progreso Tareas -->
                                    <ProgressBar Height="3" 
                                                 Minimum="0" 
                                                 Maximum="{Binding TotalTareas, Mode=OneWay}" 
                                                 Value="{Binding TareasCompletadas, Mode=OneWay}" 
                                                 Background="{StaticResource NeutralBorderBrush}" 
                                                 Foreground="{StaticResource InfoBlueBrush}" 
                                                 BorderThickness="0"
                                                 Margin="0,2,0,0">
                                        <ProgressBar.Style>
                                            <Style TargetType="ProgressBar">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding TieneTareas}" Value="False">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ProgressBar.Style>
                                    </ProgressBar>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2" Orientation="Vertical" VerticalAlignment="Center" Margin="0,0,8,0">
                                    <StackPanel Orientation="Horizontal">
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding TiempoEstimado}" Value="0">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </StackPanel.Style>
                                        <Viewbox Width="14" Height="14" Margin="0,0,5,0">
                                            <Grid Width="26" Height="26">
                                                <Ellipse Width="20" Height="20"
                                                         Stroke="{Binding ColorEstadoBrush}"
                                                         StrokeThickness="2"
                                                         HorizontalAlignment="Center"
                                                         VerticalAlignment="Center"/>
                                                <Canvas Width="24" Height="24">
                                                    <Path Data="M12 6 L12 12"
                                                          Stroke="{Binding ColorEstadoBrush}"
                                                          StrokeThickness="2"
                                                          StrokeStartLineCap="Round"
                                                          StrokeEndLineCap="Round"/>
                                                    <Path Data="M12 12 L16 14"
                                                          Stroke="{Binding ColorEstadoBrush}"
                                                          StrokeThickness="2"
                                                          StrokeStartLineCap="Round"
                                                          StrokeEndLineCap="Round"/>
                                                </Canvas>
                                            </Grid>
                                        </Viewbox>
                                        <TextBlock Text="{Binding TiempoComparativo}" FontSize="10" Foreground="{StaticResource NeutralMediumBrush}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,0" HorizontalAlignment="Center">
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding TieneTareas}" Value="False">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </StackPanel.Style>
                                        <Viewbox Width="14" Height="14" Margin="0,3,6,0">
                                            <Canvas Width="24" Height="24">
                                                <Path Data="M5 12 L10 17 L19 7"
                                                      Stroke="{StaticResource InfoBlueBrush}"
                                                      StrokeThickness="2"
                                                      StrokeLineJoin="Round"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"
                                                      Fill="Transparent"/>
                                            </Canvas>
                                        </Viewbox>
                                        <TextBlock FontSize="10" Foreground="{StaticResource NeutralMediumBrush}" FontWeight="SemiBold" VerticalAlignment="Center">
                                            <Run Text="{Binding TareasCompletadas, Mode=OneWay}"/>
                                            <Run Text="/"/>
                                            <Run Text="{Binding TotalTareas, Mode=OneWay}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel>
                                
                                <!-- 4. Prioridad (Pill con icono) -->
                                <Border Grid.Column="3"
                                        CornerRadius="15"
                                        Padding="5,0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Center"
                                        Margin="0,0,2,0"
                                        Width="25"
                                        Height="25">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="{StaticResource PriorityNormalBrush}"/>
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Prioridad}" Value="Critica">
                                                    <Setter Property="Background" Value="{StaticResource PriorityCriticalBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Prioridad}" Value="Alta">
                                                    <Setter Property="Background" Value="{StaticResource PriorityHighBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Prioridad}" Value="Menor">
                                                    <Setter Property="Background" Value="{StaticResource PriorityLowBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Prioridad}" Value="">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Prioridad}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <Viewbox x:Name="PrioridadCriticaIcon"
                                                 Width="14"
                                                 Height="14"
                                                 Visibility="Collapsed">
                                            <Canvas Width="26" Height="26">
                                                <Path Data="M12 4 L3 20 H21 Z"
                                                      Stroke="White"
                                                      StrokeThickness="2"
                                                      StrokeLineJoin="Round"
                                                      Fill="Transparent"/>
                                                <Path Data="M12 9 L12 13"
                                                      Stroke="White"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                                <Path Data="M12 17 L12.01 17"
                                                      Stroke="White"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                            </Canvas>
                                        </Viewbox>
                                        <Viewbox x:Name="PrioridadAltaIcon"
                                                 Width="16"
                                                 Height="16"
                                                 Visibility="Collapsed">
                                            <Canvas Width="24" Height="24">
                                                <Ellipse Width="18" Height="18"
                                                         Stroke="White"
                                                         StrokeThickness="2"
                                                         Canvas.Left="3"
                                                         Canvas.Top="3"/>
                                                <Path Data="M12 8 L12 15"
                                                      Stroke="White"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                                <Path Data="M9 11 L12 8 L15 11"
                                                      Stroke="White"
                                                      StrokeThickness="2"
                                                      StrokeLineJoin="Round"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"
                                                      Fill="Transparent"/>
                                            </Canvas>
                                        </Viewbox>
                                        <Viewbox x:Name="PrioridadNormalIcon"
                                                 Width="16"
                                                 Height="16"
                                                 Visibility="Visible">
                                            <Canvas Width="24" Height="24">
                                                <Ellipse Width="18" Height="18"
                                                         Stroke="White"
                                                         StrokeThickness="2"
                                                         Canvas.Left="3"
                                                         Canvas.Top="3"/>
                                                <Path Data="M9 12 L15 12"
                                                      Stroke="White"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                            </Canvas>
                                        </Viewbox>
                                        <Viewbox x:Name="PrioridadMenorIcon"
                                                 Width="16"
                                                 Height="16"
                                                 Visibility="Collapsed">
                                            <Canvas Width="24" Height="24">
                                                <Ellipse Width="18" Height="18"
                                                         Stroke="White"
                                                         StrokeThickness="2"
                                                         Canvas.Left="3"
                                                         Canvas.Top="3"/>
                                                <Path Data="M12 9 L12 16"
                                                      Stroke="White"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                                <Path Data="M9 13 L12 16 L15 13"
                                                      Stroke="White"
                                                      StrokeThickness="2"
                                                      StrokeLineJoin="Round"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"
                                                      Fill="Transparent"/>
                                            </Canvas>
                                        </Viewbox>
                                    </StackPanel>
                                </Border>
                                
                                <!-- 4. Estado (Pill) -->
                                <Border Grid.Column="4" 
                                        Background="{Binding ColorEstadoBrush}" 
                                        CornerRadius="15" 
                                        Padding="0,6"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Center"
                                        Margin="0,0,8,0"
                                        Width="25"
                                        Height="25">
                                    <TextBlock Text="{Binding EstadoAbreviado}" 
                                               Foreground="{StaticResource TextWhiteBrush}" 
                                               FontSize="10" 
                                               FontWeight="SemiBold"
                                               HorizontalAlignment="Center"/>
                                </Border>
                                
                                <!-- 5. Usuario -->
                                <TextBlock Grid.Column="5"
                                           Text="{Binding AsignadoAUpper}" 
                                           MaxWidth="90" 
                                           TextTrimming="CharacterEllipsis"
                                           TextWrapping="Wrap"
                                           MaxHeight="32"
                                           VerticalAlignment="Center" 
                                           Foreground="{StaticResource NeutralMediumBrush}" 
                                           FontSize="10"
                                           Margin="0,0,8,0"
                                           ToolTip="{Binding AsignadoAUpper}"/>

                                <!-- 6. Acciones -->
                                <StackPanel Grid.Column="6" Orientation="Horizontal" VerticalAlignment="Center">
                                    
                                    
                                    <!-- Ver Detalles -->
                                    <Button Click="DetailsButton_Click" Tag="{Binding}" Margin="0,0,5,0" Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="Ver detalles">
                                        <Viewbox Width="16" Height="16">
                                            <Canvas Width="24" Height="24">
                                                <Path Data="M2 12 C5 7,19 7,22 12 C19 17,5 17,2 12"
                                                      Stroke="{StaticResource InfoBlueBrush}"
                                                      StrokeThickness="2"
                                                      StrokeLineJoin="Round"
                                                      Fill="Transparent"/>
                                                <Ellipse Width="6" Height="6"
                                                         Stroke="{StaticResource InfoBlueBrush}"
                                                         StrokeThickness="2"
                                                         Canvas.Left="9"
                                                         Canvas.Top="9"/>
                                            </Canvas>
                                        </Viewbox>
                                    </Button>

                                    
                                    <!-- Editar -->
                                    <Button Click="EditButton_Click" Tag="{Binding}" Margin="0,0,5,0" Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="Editar Registro">
                                        <Viewbox Width="16" Height="16">
                                            <Canvas Width="24" Height="24">
                                                <Path Data="M3 21 L9 21 L21 9 L15 3 L3 15 Z"
                                                      Stroke="{StaticResource PrimaryOrangeBrush}"
                                                      StrokeThickness="2"
                                                      StrokeLineJoin="Round"
                                                      Fill="Transparent"/>
                                            </Canvas>
                                        </Viewbox>
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Estado}" Value="Pendiente">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Estado}" Value="EnEspera">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- Reenviar Notificación -->
                                    <Button Click="ResendNotificationButton_Click" Tag="{Binding}" Margin="0,0,5,0" Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="Reenviar Notificación">
                                        <Viewbox Width="16" Height="16">
                                            <Canvas Width="24" Height="24">
                                                <Path Data="M22 2 L11 13 M22 2 L15 22 L11 13 L2 9 L22 2"
                                                      Stroke="{StaticResource InfoBlueBrush}"
                                                      StrokeThickness="2"
                                                      StrokeLineJoin="Round"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"
                                                      Fill="Transparent"/>
                                            </Canvas>
                                        </Viewbox>
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding AsignadoA, Converter={StaticResource StringToBooleanConverter}}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <Button Margin="0,0,5,0"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Cursor="Hand"
                                            ToolTip="Ver Tareas"
                                            Visibility="{Binding TieneTareas, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Viewbox Width="16" Height="16">
                                            <Canvas Width="24" Height="24">
                                                <Path Data="M4 6 L10 6"
                                                      Stroke="{StaticResource InfoBlueBrush}"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                                <Path Data="M4 12 L10 12"
                                                      Stroke="{StaticResource InfoBlueBrush}"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                                <Path Data="M4 18 L10 18"
                                                      Stroke="{StaticResource InfoBlueBrush}"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                                <Path Data="M14 6 L16 8 L20 4"
                                                      Stroke="{StaticResource InfoBlueBrush}"
                                                      StrokeThickness="2"
                                                      StrokeLineJoin="Round"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                                <Path Data="M14 12 L16 14 L20 10"
                                                      Stroke="{StaticResource InfoBlueBrush}"
                                                      StrokeThickness="2"
                                                      StrokeLineJoin="Round"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                                <Path Data="M14 18 L16 20 L20 16"
                                                      Stroke="{StaticResource InfoBlueBrush}"
                                                      StrokeThickness="2"
                                                      StrokeLineJoin="Round"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                            </Canvas>
                                        </Viewbox>
                                    </Button>

                                    <Button Click="EstimateButton_Click" Tag="{Binding}" Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="Asignar Tiempo">
                                        <Viewbox Width="16" Height="16">
                                            <Canvas Width="24" Height="24">
                                                <Ellipse Width="18" Height="18"
                                                         Stroke="{StaticResource PrimaryOrangeBrush}"
                                                         StrokeThickness="2"
                                                         Canvas.Left="3"
                                                         Canvas.Top="3"/>
                                                <Path Data="M12 7 L12 12"
                                                      Stroke="{StaticResource PrimaryOrangeBrush}"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                                <Path Data="M12 12 L16 14"
                                                      Stroke="{StaticResource PrimaryOrangeBrush}"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"/>
                                            </Canvas>
                                        </Viewbox>
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Estado}" Value="Pendiente">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </Grid>
                            </Grid>
                        </Border>
                        <DataTemplate.Triggers>
                            <DataTrigger Binding="{Binding Prioridad}" Value="Critica">
                                <Setter TargetName="PrioridadCriticaIcon" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="PrioridadAltaIcon" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="PrioridadNormalIcon" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="PrioridadMenorIcon" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Prioridad}" Value="Alta">
                                <Setter TargetName="PrioridadCriticaIcon" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="PrioridadAltaIcon" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="PrioridadNormalIcon" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="PrioridadMenorIcon" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Prioridad}" Value="Menor">
                                <Setter TargetName="PrioridadCriticaIcon" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="PrioridadAltaIcon" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="PrioridadNormalIcon" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="PrioridadMenorIcon" Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
